---
apiVersion: projectcalico.org/v3
kind: GlobalNetworkPolicy
metadata:
  name: allow-cluster-internal-ingress
spec:
  order: 10
  preDNAT: true
  applyOnForward: true
  ingress:
    - action: Allow
      source:
        nets: [{{ calico_pod_cidr }},{{ pod_network_cidr }},{{ hosts_cidr }}]
  selector: has(worker-endpoint) || has(control-endpoint)
---
apiVersion: projectcalico.org/v3
kind: GlobalNetworkPolicy
metadata:
  name: drop-other-ingress
spec:
  order: 20
  preDNAT: true
  applyOnForward: true
  ingress:
    - action: Deny
  selector: has(worker-endpoint) || has(control-endpoint)
---
apiVersion: projectcalico.org/v3
kind: GlobalNetworkPolicy
metadata:
  name: allow-web-ports
spec:
  order: 19
    #applyOnForward: true  
  egress:
    - action: Allow
      protocol: TCP
      destination:
        ports: [80,443]
    - action: Allow
      protocol: UDP
      destination:
        ports: [53]         
  selector: has(worker-endpoint) || has(control-endpoint) 
---
apiVersion: projectcalico.org/v3
kind: GlobalNetworkPolicy
metadata:
  name: allow-ssh
spec:
  order: 19
    #applyOnForward: true  
  egress:
    - action: Allow
      protocol: TCP
      destination:
        ports: [22]
  ingress:
    - action: Allow
      protocol: TCP
      destination:
        ports: [22]
  selector: has(worker-endpoint) || has(control-endpoint)